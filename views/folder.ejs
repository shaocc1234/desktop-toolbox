<!DOCTYPE html>
<html lang="zh-CN" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件夹管理 - 图库上传工具</title>

    <%- include('partials/app-init') %>

    <!-- Bootstrap CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <!-- 自定义样式 -->
    <link href="/css/custom.css" rel="stylesheet">
</head>
<body>

<div class="app-container">
    <!-- 左侧侧边栏 -->
    <div class="sidebar bg-light border-end" id="sidebar">
        <%- include('partials/sidebar') %>
    </div>

    <!-- 右侧主内容区 -->
    <div class="main-content" id="main-content">
        <main class="p-3">
        <div class="container-fluid">
            <!-- 页面标题 -->
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                    <h5 class="mb-1">
                        <i class="bi bi-folder-fill me-2"></i>
                        文件夹管理
                    </h5>
                    <small class="text-muted">智能整理文件夹，让您的文件井然有序</small>
                </div>
            </div>

            <!-- 使用说明 - 紧凑版 -->
            <div class="card mb-2" style="border-left: 3px solid var(--accent-color);">
                <div class="card-body py-2">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-info-circle text-primary"></i>
                        </div>
                        <div class="col">
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <small><strong>1.</strong> 选择目录路径</small>
                                </div>
                                <div class="col-md-3">
                                    <small><strong>2.</strong> 扫描分析内容</small>
                                </div>
                                <div class="col-md-3">
                                    <small><strong>3.</strong> 选择整理功能</small>
                                </div>
                                <div class="col-md-3">
                                    <small><strong>4.</strong> 预览后执行</small>
                                </div>
                            </div>
                            <div class="mt-1">
                                <small class="text-muted">
                                    <i class="bi bi-shield-check text-success me-1"></i>
                                    系统会自动跳过年份文件夹，建议重要文件先备份
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 目录选择区域 -->
            <div class="card mb-2">
                <div class="card-header py-2">
                    <h6 class="mb-0">
                        <i class="bi bi-folder2-open me-2"></i>
                        目录选择
                    </h6>
                </div>
                <div class="card-body py-2">
                    <div class="row g-2">
                        <div class="col-md-8">
                            <div class="position-relative">
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">
                                        <i class="bi bi-folder"></i>
                                    </span>
                                    <input type="text" class="form-control" id="directoryPath"
                                           placeholder="请输入文件夹路径，如：/path/to/folder"
                                           autocomplete="off">
                                    <button class="btn btn-outline-secondary" type="button" id="browseBtn">
                                        <i class="bi bi-search me-1"></i>浏览
                                    </button>
                                    <button class="btn btn-outline-danger" type="button" id="clearHistoryBtn" title="清空历史记录" style="display: none;">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <!-- 历史目录下拉列表 -->
                                <div class="dropdown-menu w-100" id="historyDropdown" style="max-height: 300px; overflow-y: auto;">
                                    <!-- 历史记录将在这里动态加载 -->
                                </div>
                            </div>
                            <div class="form-text mt-1">
                                <small>
                                    <i class="bi bi-lightbulb text-warning me-1"></i>
                                    点击输入框查看历史记录，支持绝对路径和相对路径
                                </small>
                            </div>
                            <!-- 扫描选项 -->
                            <div class="row g-2 mt-1">
                                <div class="col-md-6">
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input" type="checkbox" id="includeSubfoldersCheck" checked>
                                        <label class="form-check-label small" for="includeSubfoldersCheck">
                                            <i class="bi bi-folder-plus me-1"></i>扫描子文件夹
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input" type="checkbox" id="useOptimizedCheck" checked>
                                        <label class="form-check-label small" for="useOptimizedCheck">
                                            <i class="bi bi-lightning me-1"></i>优化扫描
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-primary w-100" id="scanBtn">
                                <i class="bi bi-search me-2"></i>开始扫描
                            </button>
                            <div class="form-text text-center mt-1">
                                <small class="text-muted">点击扫描查看目录内容</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 目录统计信息 -->
            <div class="card mb-2" id="statsCard" style="display: none;">
                <div class="card-header py-2">
                    <h6 class="mb-0">
                        <i class="bi bi-bar-chart me-2"></i>
                        目录统计
                    </h6>
                </div>
                <div class="card-body py-2">
                    <div class="row g-2" id="statsContent">
                        <!-- 统计信息将在这里动态加载 -->
                    </div>
                </div>
            </div>

            <!-- 功能操作区域 -->
            <div class="row g-2 mb-2" id="operationsArea" style="display: none;">
                <!-- 智能文件分类 -->
                <div class="col-lg-6 col-md-6 mb-2">
                    <div class="card h-100">
                        <div class="card-header py-2" style="background-color: var(--bg-secondary); border-left: 3px solid var(--bs-success);">
                            <h6 class="mb-0">
                                <i class="bi bi-magic me-2 text-success"></i>智能文件分类
                            </h6>
                        </div>
                        <div class="card-body py-2">
                            <!-- 智能文件分类说明 -->
                            <div class="alert alert-success py-1 mb-2" style="font-size: 12px;">
                                <i class="bi bi-info-circle me-1"></i>自动将文件和文件夹按照指定规则进行分类整理
                            </div>

                            <!-- 智能文件分类 -->
                            <div>
                                <!-- 分类策略选择 -->
                                <div class="mb-2">
                                    <label for="classificationStrategy" class="form-label small mb-1">
                                        分类方式
                                        <i class="bi bi-info-circle text-info ms-1" data-bs-toggle="tooltip"
                                           title="选择文件分类的依据：类型（按扩展名）、时间（按创建日期）、大小（按文件大小）"></i>
                                    </label>
                                    <select class="form-select form-select-sm" id="classificationStrategy">
                                        <option value="extension">按文件类型分类（推荐）</option>
                                        <option value="date">按时间分类</option>
                                        <option value="size">按文件大小分类</option>
                                        <option value="hybrid">混合分类</option>
                                    </select>
                                </div>

                                <!-- 策略选项容器 -->
                                <div id="strategyOptionsContainer" class="mb-2">
                                    <!-- 动态加载策略选项 -->
                                </div>

                                <!-- 通用选项 -->
                                <div class="mb-2">
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input" type="checkbox" id="createSubfoldersCheck" checked>
                                        <label class="form-check-label small" for="createSubfoldersCheck">
                                            创建子文件夹
                                        </label>
                                    </div>
                                </div>

                                <!-- 操作按钮 -->
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-outline-primary btn-sm" id="previewClassifyBtn"
                                            data-bs-toggle="tooltip" title="预览分类结果，不会实际移动文件">
                                        <i class="bi bi-eye me-1"></i>预览
                                    </button>
                                    <button class="btn btn-primary btn-sm" id="classifyBtn"
                                            data-bs-toggle="tooltip" title="执行文件分类操作（建议先预览）">
                                        <i class="bi bi-magic me-1"></i>开始分类
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 文件夹清理工具 -->
                <div class="col-lg-6 col-md-6 mb-2">
                    <div class="card h-100">
                        <div class="card-header py-2" style="background-color: var(--bg-secondary); border-left: 3px solid var(--bs-warning);">
                            <h6 class="mb-0">
                                <i class="bi bi-tools me-2 text-warning"></i>文件夹清理工具
                            </h6>
                        </div>
                        <div class="card-body py-2">
                            <!-- 清理工具说明 -->
                            <div class="alert alert-warning py-1 mb-2" style="font-size: 12px;">
                                <i class="bi bi-info-circle me-1"></i>清理空文件夹、重复文件，获取详细统计信息
                            </div>

                            <!-- 删除空文件夹 -->
                            <div class="mb-2">
                                <div class="d-flex align-items-center mb-1">
                                    <i class="bi bi-trash me-1 text-secondary"></i>
                                    <small class="fw-bold">删除空文件夹</small>
                                    <i class="bi bi-info-circle text-info ms-1" data-bs-toggle="tooltip"
                                       title="自动查找并删除不包含任何文件的空文件夹"></i>
                                </div>
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-outline-secondary btn-sm" id="previewEmptyBtn"
                                            data-bs-toggle="tooltip" title="先查看哪些文件夹会被删除">
                                        <i class="bi bi-eye me-1"></i>预览
                                    </button>
                                    <button class="btn btn-secondary btn-sm" id="deleteEmptyBtn"
                                            data-bs-toggle="tooltip" title="执行删除操作（建议先预览）">
                                        <i class="bi bi-trash me-1"></i>删除
                                    </button>
                                </div>
                            </div>

                            <!-- 重复文件清理 -->
                            <div class="mb-2">
                                <div class="d-flex align-items-center mb-1">
                                    <i class="bi bi-files me-1 text-secondary"></i>
                                    <small class="fw-bold">重复文件清理</small>
                                    <i class="bi bi-info-circle text-info ms-1" data-bs-toggle="tooltip"
                                       title="查找并删除内容完全相同的重复文件"></i>
                                </div>
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-outline-secondary btn-sm" id="previewDuplicatesBtn"
                                            data-bs-toggle="tooltip" title="查找重复文件">
                                        <i class="bi bi-search me-1"></i>查找
                                    </button>
                                    <button class="btn btn-secondary btn-sm" id="removeDuplicatesBtn"
                                            data-bs-toggle="tooltip" title="删除重复文件（建议先查找）">
                                        <i class="bi bi-trash me-1"></i>删除
                                    </button>
                                </div>
                            </div>

                            <!-- 详细统计 -->
                            <div>
                                <div class="d-flex align-items-center mb-1">
                                    <i class="bi bi-graph-up me-1 text-secondary"></i>
                                    <small class="fw-bold">详细统计</small>
                                    <i class="bi bi-info-circle text-info ms-1" data-bs-toggle="tooltip"
                                       title="获取目录的详细统计信息，包括文件类型分布等"></i>
                                </div>
                                <button class="btn btn-primary btn-sm w-100" id="detailStatsBtn"
                                        data-bs-toggle="tooltip" title="生成详细的目录统计报告">
                                    <i class="bi bi-graph-up me-1"></i>获取详细统计
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 结果显示区域 -->
            <div class="card" id="resultCard" style="display: none;">
                <div class="card-header py-2">
                    <h6 class="mb-0">
                        <i class="bi bi-list-check me-2"></i>
                        操作结果
                    </h6>
                </div>
                <div class="card-body py-2">
                    <div id="resultContent">
                        <!-- 结果内容将在这里动态加载 -->
                    </div>
                </div>
            </div>
        </div>
            </main>
        </div>
    </div>

<!-- 确认对话框模态框 -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title">确认操作</h6>
                <button type="button" class="btn-close btn-close-sm" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body py-2" id="confirmModalBody">
                <!-- 确认内容 -->
            </div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-danger btn-sm" id="confirmActionBtn">确认</button>
            </div>
        </div>
    </div>
</div>

<!-- 加载提示 -->
<div class="position-fixed top-50 start-50 translate-middle" id="loadingSpinner" style="display: none; z-index: 9999;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">加载中...</span>
    </div>
</div>

<!-- 进度条 -->
<div class="position-fixed top-0 start-0 w-100" id="progressContainer" style="display: none; z-index: 9998;">
    <div class="progress-container-bg border-bottom shadow-sm p-2" style="background-color: var(--bg-primary);">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-1">
                <span class="progress-title small fw-bold">
                    <i class="bi bi-folder-check me-2"></i>扫描进度
                </span>
                <span id="progressText" class="badge bg-primary">0%</span>
            </div>
            <div class="progress mb-1" style="height: 4px;">
                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                     role="progressbar" style="width: 0%; background-color: var(--accent-color);" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                </div>
            </div>
            <div id="progressMessage" class="progress-message small text-muted">
                <i class="bi bi-clock me-1"></i>准备开始扫描...
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- 侧边栏管理 -->
<script src="/js/sidebar.js"></script>
<!-- 主题管理 -->
<script src="/js/theme.js"></script>
<!-- 通用工具 -->
<script src="/js/utils.js"></script>
<!-- 文件夹管理页面脚本 -->
<script src="/js/folder.js"></script>

<script>
// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    // 初始化工具提示
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
</body>
</html>
