<!DOCTYPE html>
<html lang="zh-CN" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI文件整理 - 工具集</title>

    <!-- Bootstrap CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <!-- 自定义样式 -->
    <link href="/css/custom.css" rel="stylesheet">
    <style>
        /* 拖拽上传区域样式 */
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-area:hover, .upload-area.drag-over {
            border-color: #0d6efd;
            background-color: rgba(13, 110, 253, 0.05);
        }
        .file-item {
            transition: all 0.2s ease;
        }
        .file-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        [data-bs-theme="dark"] .file-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body>
<div class="app-container">
    <!-- 左侧侧边栏 -->
    <div class="sidebar bg-light border-end" id="sidebar">
        <%- include('partials/sidebar') %>
    </div>

    <!-- 右侧主内容区 -->
    <div class="main-content" id="main-content">
        <main class="p-4">
            <div class="container-fluid">
                <!-- 页面标题 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h2>
                            <i class="bi bi-robot text-primary me-2"></i>
                            AI文件整理
                        </h2>
                        <p class="text-muted">使用AI智能分析文件路径，自动分类整理文件和文件夹</p>
                    </div>
                </div>

                <!-- AI文件整理工作流程 -->
                <div class="row">
                    <!-- 步骤1：选择文件夹 -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-1-circle text-primary me-2"></i>
                                    选择要整理的文件夹
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="bi bi-folder"></i>
                                            </span>
                                            <input type="text" class="form-control" id="directoryPath"
                                                   placeholder="请输入文件夹路径，如：/Users/username/Documents">
                                            <button class="btn btn-outline-secondary" type="button" id="browseBtn">
                                                <i class="bi bi-search me-1"></i>浏览
                                            </button>
                                        </div>
                                        <div class="form-text">
                                            <i class="bi bi-info-circle me-1"></i>
                                            将扫描指定文件夹下最深2级的所有文件和文件夹
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-primary w-100" id="scanBtn">
                                            <i class="bi bi-search me-2"></i>扫描文件夹
                                        </button>
                                    </div>
                                    <div class="col-md-1">
                                        <button class="btn btn-outline-info w-100" id="historyBtn" title="查看文件移动记录">
                                            <i class="bi bi-clock-history"></i>
                                        </button>
                                    </div>
                                    <div class="col-md-1">
                                        <button class="btn btn-outline-secondary w-100" id="promptHistoryBtn" title="查看提示词历史">
                                            <i class="bi bi-chat-text"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 移动记录显示区域 -->
                    <div class="col-12 mb-4" id="moveHistorySection" style="display: none;">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-clock-history text-info me-2"></i>
                                    文件移动记录
                                </h6>
                                <button class="btn btn-sm btn-outline-secondary" id="closeMoveHistory">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="moveHistoryContent">
                                    <!-- 移动记录内容将在这里显示 -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 提示词和对话历史显示区域 -->
                    <div class="col-12 mb-4" id="promptHistorySection" style="display: none;">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-chat-text text-secondary me-2"></i>
                                    提示词和对话历史
                                </h6>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-primary" id="showPromptHistoryBtn">
                                        <i class="bi bi-file-text me-1"></i>提示词
                                    </button>
                                    <button class="btn btn-outline-success" id="showDialogueHistoryBtn">
                                        <i class="bi bi-chat-dots me-1"></i>对话
                                    </button>
                                    <button class="btn btn-outline-danger" id="clearHistoryBtn">
                                        <i class="bi bi-trash me-1"></i>清空
                                    </button>
                                    <button class="btn btn-outline-secondary" id="closePromptHistory">
                                        <i class="bi bi-x"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="promptHistoryContent">
                                    <!-- 历史记录内容将在这里显示 -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤2：AI配置 -->
                    <div class="col-12 mb-4" id="aiConfigSection" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-2-circle text-primary me-2"></i>
                                    AI配置
                                </h6>
                            </div>
                            <div class="card-body">
                                <!-- API密钥和模型配置 -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <label for="apiKey" class="form-label">硅基流动 API 密钥</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="bi bi-key"></i>
                                            </span>
                                            <input type="password" class="form-control" id="apiKey"
                                                   placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxx">
                                            <button class="btn btn-outline-secondary" type="button" id="toggleApiKey">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        </div>
                                        <div class="form-text">
                                            <i class="bi bi-shield-check text-success me-1"></i>
                                            API密钥仅在本地使用，不会上传到服务器
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="aiModel" class="form-label">AI模型</label>
                                        <select class="form-select" id="aiModel">
                                            <option value="BAAI/bge-m3">BAAI/bge-m3 (推荐)</option>
                                            <option value="Pro/deepseek-ai/DeepSeek-R1">DeepSeek-R1</option>
                                            <option value="Pro/deepseek-ai/DeepSeek-V3">DeepSeek-V3</option>
                                            <option value="Qwen/Qwen3-Next-80B-A3B-Instruct">Qwen3-Next-80B</option>
                                            <option value="Pro/Qwen/Qwen2.5-72B-Instruct">Qwen2.5-72B</option>
                                            <option value="ByteDance-Seed/Seed-OSS-36B-Instruct">Seed-OSS-36B</option>
                                            <option value="Qwen/Qwen3-Coder-30B-A3B-Instruct">Qwen3-Coder-30B</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">&nbsp;</label>
                                        <button class="btn btn-success w-100" id="classifyBtn" disabled>
                                            <i class="bi bi-magic me-2"></i>AI分类
                                        </button>
                                    </div>
                                </div>

                                <!-- 分类提示词配置 -->
                                <div class="row">
                                    <div class="col-12">
                                        <label class="form-label">
                                            <i class="bi bi-chat-text me-1"></i>
                                            分类提示词模板
                                        </label>
                                        <div class="mb-3">
                                            <div class="btn-group" role="group" aria-label="提示词模板">
                                                <input type="radio" class="btn-check" name="promptTemplate" id="template-default" value="default" checked>
                                                <label class="btn btn-outline-primary" for="template-default">
                                                    <i class="bi bi-folder me-1"></i>通用分类
                                                </label>

                                                <input type="radio" class="btn-check" name="promptTemplate" id="template-work" value="work">
                                                <label class="btn btn-outline-primary" for="template-work">
                                                    <i class="bi bi-briefcase me-1"></i>办公文档
                                                </label>

                                                <input type="radio" class="btn-check" name="promptTemplate" id="template-media" value="media">
                                                <label class="btn btn-outline-primary" for="template-media">
                                                    <i class="bi bi-camera me-1"></i>媒体文件
                                                </label>

                                                <input type="radio" class="btn-check" name="promptTemplate" id="template-dev" value="dev">
                                                <label class="btn btn-outline-primary" for="template-dev">
                                                    <i class="bi bi-code me-1"></i>开发项目
                                                </label>

                                                <input type="radio" class="btn-check" name="promptTemplate" id="template-custom" value="custom">
                                                <label class="btn btn-outline-secondary" for="template-custom">
                                                    <i class="bi bi-pencil me-1"></i>自定义
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 提示词编辑区域 -->
                                        <div class="position-relative">
                                            <textarea class="form-control" id="promptText" rows="8"
                                                      placeholder="AI分类提示词将在这里显示..."></textarea>
                                            <div class="position-absolute top-0 end-0 p-2">
                                                <button class="btn btn-sm btn-outline-secondary" type="button" id="resetPromptBtn" title="重置为模板默认值">
                                                    <i class="bi bi-arrow-clockwise"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="form-text">
                                            <i class="bi bi-info-circle me-1"></i>
                                            选择预设模板或自定义提示词来指导AI如何分类文件。提示词会影响分类结果的准确性。
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤3：扫描结果 -->
                    <div class="col-12 mb-4" id="scanResultSection" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-3-circle text-primary me-2"></i>
                                    扫描结果
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row" id="scanStats">
                                    <!-- 扫描统计信息将在这里显示 -->
                                </div>
                                <div class="mt-3">
                                    <h6>文件和文件夹列表：</h6>
                                    <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                        <table class="table table-sm table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>类型</th>
                                                    <th>名称</th>
                                                    <th>路径</th>
                                                    <th>大小</th>
                                                </tr>
                                            </thead>
                                            <tbody id="fileListBody">
                                                <!-- 文件列表将在这里显示 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤4：AI分类结果 -->
                    <div class="col-12 mb-4" id="classificationSection" style="display: none;">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-4-circle text-primary me-2"></i>
                                    AI分类结果
                                    <span class="badge bg-secondary ms-2" id="roundCounter">第1轮</span>
                                </h6>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-warning" id="optimizeBtn" title="根据AI建议优化分类">
                                        <i class="bi bi-magic me-1"></i>优化分类
                                    </button>
                                    <button class="btn btn-outline-secondary" id="resetClassificationBtn" title="重新开始分类">
                                        <i class="bi bi-arrow-clockwise me-1"></i>重新分类
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- 分类历史记录 -->
                                <div id="classificationHistory" style="display: none;">
                                    <h6 class="text-muted mb-2">
                                        <i class="bi bi-clock-history me-1"></i>分类历史
                                    </h6>
                                    <div class="mb-3" style="max-height: 200px; overflow-y: auto;">
                                        <div id="historyList">
                                            <!-- 历史记录将在这里显示 -->
                                        </div>
                                    </div>
                                    <hr>
                                </div>

                                <!-- 当前分类结果 -->
                                <div id="classificationResult">
                                    <!-- AI分类结果将在这里显示 -->
                                </div>

                                <!-- AI建议和对话区域 -->
                                <div class="mt-4">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">
                                            <i class="bi bi-lightbulb me-1"></i>AI建议与对话
                                        </h6>
                                        <button class="btn btn-sm btn-outline-info" id="toggleHistoryBtn">
                                            <i class="bi bi-eye me-1"></i>查看历史
                                        </button>
                                    </div>

                                    <!-- AI建议显示 -->
                                    <div id="aiSuggestions" class="alert alert-info">
                                        <!-- AI建议将在这里显示 -->
                                    </div>

                                    <!-- 用户反馈输入区域 -->
                                    <div class="mt-3">
                                        <label for="userFeedback" class="form-label">
                                            <i class="bi bi-chat-dots me-1"></i>
                                            您的反馈或调整要求：
                                        </label>
                                        <div class="input-group">
                                            <textarea class="form-control" id="userFeedback" rows="3"
                                                      placeholder="例如：请将图片文件按日期分类，创建2023年、2024年子文件夹；或者：合并文档资料和办公文件为一个类别"></textarea>
                                            <button class="btn btn-primary" type="button" id="sendFeedbackBtn">
                                                <i class="bi bi-send me-1"></i>发送反馈
                                            </button>
                                        </div>
                                        <div class="form-text">
                                            <i class="bi bi-info-circle me-1"></i>
                                            描述您希望如何调整分类结果，AI会根据您的反馈重新优化分类方案
                                        </div>
                                    </div>

                                    <!-- 快速建议按钮 -->
                                    <div class="mt-3">
                                        <div class="d-flex flex-wrap gap-2">
                                            <button class="btn btn-sm btn-outline-secondary quick-suggestion"
                                                    data-suggestion="请创建更详细的子文件夹分类">
                                                <i class="bi bi-folder-plus me-1"></i>创建子文件夹
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary quick-suggestion"
                                                    data-suggestion="请按文件类型进一步细分类别">
                                                <i class="bi bi-file-earmark me-1"></i>按类型细分
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary quick-suggestion"
                                                    data-suggestion="请按日期或时间创建分类文件夹">
                                                <i class="bi bi-calendar me-1"></i>按日期分类
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary quick-suggestion"
                                                    data-suggestion="请合并相似的分类类别">
                                                <i class="bi bi-union me-1"></i>合并类别
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary quick-suggestion"
                                                    data-suggestion="请简化分类结构，减少文件夹层级">
                                                <i class="bi bi-diagram-2 me-1"></i>简化结构
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤5：确认和执行 -->
                    <div class="col-12 mb-4" id="executeSection" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-5-circle text-primary me-2"></i>
                                    确认和执行
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <button class="btn btn-outline-info w-100 mb-2" id="previewBtn">
                                            <i class="bi bi-eye me-2"></i>预览移动操作
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-success w-100 mb-2" id="executeBtn">
                                            <i class="bi bi-check-circle me-2"></i>执行文件移动
                                        </button>
                                    </div>
                                </div>
                                <div class="alert alert-warning mt-3">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    <strong>注意：</strong>执行操作将实际移动文件，建议先预览确认无误后再执行。
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 结果显示区域 -->
                    <div class="col-12" id="resultSection" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    操作结果
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="operationResult">
                                    <!-- 操作结果将在这里显示 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- 加载提示 -->
<div class="position-fixed top-50 start-50 translate-middle" id="loadingSpinner" style="display: none; z-index: 9999;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">加载中...</span>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- 侧边栏管理 -->
<script src="/js/sidebar.js"></script>
<!-- 主题管理 -->
<script src="/js/theme.js"></script>
<!-- 通用工具 -->
<script src="/js/utils.js"></script>
<!-- AI文件整理页面脚本 -->
<script src="/js/aiorganizer.js"></script>
</body>
</html>
